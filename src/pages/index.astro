---
import CyberLayout from '../layouts/CyberLayout.astro';
import { getCollection } from "astro:content";

// 1. Fetch all releases from the 'releases' content collection
const allReleases = await getCollection('releases');

// 2. Sort releases by publication date (newest first)
const sortedReleases = allReleases.sort((a, b) => 
  b.data.pubDate.getTime() - a.data.pubDate.getTime()
);

// 3. Define the maximum width for content inside the layout
const MAX_CONTENT_WIDTH = "max-w-4xl"; // Ensures readability on very wide screens
---

<CyberLayout title="PeDitXOS Releases">
  <div class={`mx-auto px-4 pt-16 pb-20 ${MAX_CONTENT_WIDTH}`}>
    
    <!-- Title Section: Displayed only if there are releases or if user is prompted -->
    <h1 class="text-4xl md:text-5xl font-black font-orbitron text-neon-cyan text-center mt-12 mb-16 uppercase tracking-widest">
      SYSTEM_LOG: ALL RELEASES
    </h1>

    <!-- Content Area: List of Releases -->
    <div class="space-y-10">
      
      <!-- Conditional rendering: Check if any releases exist -->
      {sortedReleases.length > 0 ? (
        
        <!-- Loop through all sorted posts -->
        sortedReleases.map((release) => (
          
          <a href={`/releases/${release.slug}`} class="block transition duration-300 ease-in-out">
            <article class="cyber-card p-6 md:p-8 rounded-lg">
              
              <!-- Release Metadata -->
              <div class="flex flex-col md:flex-row justify-between items-start md:items-center border-b border-[var(--border-color)] pb-3 mb-4">
                
                <h2 class="text-2xl md:text-3xl font-bold font-orbitron text-neon-magenta hover:text-neon-cyan transition-colors leading-snug mb-2 md:mb-0">
                  {release.data.title}
                </h2>
                
                <time class="text-sm text-gray-500 font-rajdhani tracking-wider whitespace-nowrap">
                  {release.data.pubDate.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                  })}
                </time>
              </div>

              <!-- Release Description -->
              <p class="text-gray-300 mb-4 text-lg">
                {release.data.description}
              </p>

              <!-- Read More Link -->
              <div class="flex items-center justify-end">
                <span class="text-neon-cyan hover:text-white transition-colors text-lg font-orbitron tracking-wider">
                  Read More 
                  <i class="fas fa-arrow-right ml-2 text-sm"></i>
                </span>
              </div>
            </article>
          </a>
        ))
        // پرانتز بسته برای Map در انتهای آن قرار دارد.
        
      ) : (
        <!-- Message displayed if no content is published yet -->
        <div class="text-center p-10 mt-12 cyber-card mx-auto">
          <p class="text-2xl text-gray-400 mb-4 font-rajdhani">
            No releases published yet. Add content via the CMS panel!
          </p>
          <a href="/admin/" class="btn-cyber py-3 px-6 text-base uppercase tracking-wider inline-block">
            Access Content Manager
          </a>
        </div>
      )}

    </div>
  </div>
</CyberLayout>
