---
import { getCollection, getEntryBySlug } from "astro:content";
import CyberLayout from "../../layouts/CyberLayout.astro";

// Function required for Astro dynamic routing
export async function getStaticPaths() {
  const releases = await getCollection("releases");
  return releases.map((release) => ({
    params: { slug: release.slug },
    props: { release },
  }));
}

const { release } = Astro.props;
const { Content } = await release.render();

// Format date utility (replicated here for detail page)
const formatDate = (date: Date) => {
    return new Intl.DateTimeFormat('fa-IR', { 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
    }).format(date);
}
---

<CyberLayout title={release.data.title} showStaticContent={false}>
    <section class="py-32 bg-black/30">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-4xl">
            <a href="/" class="text-neon-magenta hover:text-neon-cyan transition-colors mb-6 block font-orbitron text-sm">
                <i class="fas fa-arrow-right ml-2"></i> بازگشت به صفحه اصلی
            </a>
            
            <header class="mb-10 border-b border-[var(--border-color)] pb-6">
                <h1 class="text-4xl md:text-5xl font-black font-orbitron text-neon-cyan mb-4">
                    {release.data.title}
                </h1>
                <p class="text-gray-400 italic mb-2">
                    {release.data.description}
                </p>
                <p class="text-sm text-neon-magenta font-orbitron">
                    تاریخ انتشار: {formatDate(release.data.pubDate)}
                </p>
            </header>

            {release.data.coverImage && (
                <img 
                    src={release.data.coverImage} 
                    alt={`Cover image for ${release.data.title}`} 
                    class="w-full h-64 object-cover rounded-lg mb-8 border-2 border-[var(--primary-cyan)]/50 shadow-lg shadow-[var(--primary-cyan)]/20"
                />
            )}

            <div class="markdown-content">
                <Content />
            </div>

            {release.data.scriptContent && (
                <div class="mt-10 p-6 bg-black/90 rounded-lg border border-[var(--primary-green)]/50 shadow-xl shadow-[var(--primary-green)]/10">
                    <h2 class="text-2xl font-orbitron text-neon-green mb-4">Script Content</h2>
                    <pre class="overflow-x-auto p-4 text-sm bg-gray-900 rounded-md text-neon-green/90">
                        <code>{release.data.scriptContent}</code>
                    </pre>
                </div>
            )}
        </div>
    </section>
</CyberLayout>
